[gd_scene load_steps=24 format=3 uid="uid://bnl20wr3lqhow"]

[ext_resource type="Script" uid="uid://c2h7fnj4umygf" path="res://scenes/mainscript.gd" id="1_ki6c0"]
[ext_resource type="PackedScene" uid="uid://hkb6si4cedgx" path="res://maincharrigged.blend" id="2_8ifl6"]
[ext_resource type="PackedScene" uid="uid://by6t3bsb6eggk" path="res://scenes/Marker.tscn" id="2_hhxvm"]
[ext_resource type="ArrayMesh" uid="uid://bhm8eqk5xw3kr" path="res://assets/maincharrigged.obj" id="3_twn0q"]
[ext_resource type="Script" uid="uid://c8pjb8dafad15" path="res://scenes/rigid_body_3d.gd" id="4_al2iq"]
[ext_resource type="Texture2D" uid="uid://cuxom4sfirpee" path="res://kloppenheim_06_puresky_4k.exr" id="5_1jq6i"]
[ext_resource type="AudioStream" uid="uid://db4dgjynruss5" path="res://assets/music/turiruriru-01.mp3" id="5_w16ng"]
[ext_resource type="Script" uid="uid://c1hsvx452qj01" path="res://scenes/cube.gd" id="8_dmtm4"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_8ifl6"]

[sub_resource type="PlaneMesh" id="PlaneMesh_twn0q"]
material = SubResource("StandardMaterial3D_8ifl6")
size = Vector2(2, 1.5)

[sub_resource type="BoxShape3D" id="BoxShape3D_dmtm4"]

[sub_resource type="Shader" id="Shader_hhxvm"]
code = "shader_type spatial;
render_mode blend_mix, depth_draw_always, cull_back, diffuse_burley, specular_schlick_ggx;

uniform vec4 albedo : source_color = vec4(0.0, 0.204, 0.961, 0.506);
uniform sampler2D texture_albedo : source_color, filter_linear_mipmap, repeat_enable;
uniform float roughness : hint_range(0.0, 1.0) = 0.0;
uniform float metallic : hint_range(0.0, 1.0) = 0.0;
uniform float specular : hint_range(0.0, 1.0) = 0.5;
uniform sampler2D texture_normal : hint_roughness_normal, filter_linear_mipmap, repeat_enable;
uniform float normal_scale : hint_range(-16.0, 16.0) = 1.0;
uniform float refraction : hint_range(-1.0, 1.0) = 0.05;

uniform vec3 uv1_scale = vec3(1.0, 1.0, 1.0);
uniform vec3 uv1_offset = vec3(0.0, 0.0, 0.0);
uniform float uv1_blend_sharpness = 1.0;

varying vec3 uv1_triplanar_pos;
varying vec3 uv1_power_normal;

void vertex() {
	vec3 normal = NORMAL;
	
	TANGENT = vec3(0.0, 0.0, -1.0) * abs(normal.x);
	TANGENT += vec3(1.0, 0.0, 0.0) * abs(normal.y);
	TANGENT += vec3(1.0, 0.0, 0.0) * abs(normal.z);
	TANGENT = normalize(TANGENT);
	
	BINORMAL = vec3(0.0, 1.0, 0.0) * abs(normal.x);
	BINORMAL += vec3(0.0, 0.0, -1.0) * abs(normal.y);
	BINORMAL += vec3(0.0, 1.0, 0.0) * abs(normal.z);
	BINORMAL = normalize(BINORMAL);
	
	uv1_power_normal = pow(abs(NORMAL), vec3(uv1_blend_sharpness));
	uv1_triplanar_pos = VERTEX * uv1_scale + uv1_offset + vec3(TIME * 0.1);
	uv1_power_normal /= dot(uv1_power_normal, vec3(1.0));
	uv1_triplanar_pos *= vec3(1.0, -1.0, 1.0);
}

vec4 triplanar_texture(sampler2D p_sampler, vec3 p_weights, vec3 p_triplanar_pos) {
	vec4 samp = vec4(0.0);
	samp += texture(p_sampler, p_triplanar_pos.xy) * p_weights.z;
	samp += texture(p_sampler, p_triplanar_pos.xz) * p_weights.y;
	samp += texture(p_sampler, p_triplanar_pos.zy * vec2(-1.0, 1.0)) * p_weights.x;
	return samp;
}

void fragment() {
	vec4 albedo_tex = triplanar_texture(texture_albedo, uv1_power_normal, uv1_triplanar_pos);
	ALBEDO = albedo.rgb * albedo_tex.rgb;
	
	METALLIC = metallic;
	SPECULAR = specular;
	ROUGHNESS = roughness;
	
	vec3 normal_tex = triplanar_texture(texture_normal, uv1_power_normal, uv1_triplanar_pos).rgb;
	NORMAL_MAP = normal_tex;
	NORMAL_MAP_DEPTH = normal_scale;
	
	ALPHA = albedo.a * albedo_tex.a;
}
"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_w16ng"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_1jq6i"]
noise = SubResource("FastNoiseLite_w16ng")
seamless = true
as_normal_map = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_al2iq"]
render_priority = 0
shader = SubResource("Shader_hhxvm")
shader_parameter/albedo = Color(0, 0.20392157, 0.9607843, 0.5058824)
shader_parameter/roughness = 0.0
shader_parameter/metallic = 0.0
shader_parameter/specular = 0.5
shader_parameter/texture_normal = SubResource("NoiseTexture2D_1jq6i")
shader_parameter/normal_scale = 1.0
shader_parameter/refraction = 0.05
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv1_blend_sharpness = 1.0

[sub_resource type="BoxMesh" id="BoxMesh_dmtm4"]
material = SubResource("ShaderMaterial_al2iq")
size = Vector3(0.74, 0.5, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_w16ng"]

[sub_resource type="ConcavePolygonShape3D" id="ConcavePolygonShape3D_twn0q"]
data = PackedVector3Array(1, 0, 1, -1, 0, 1, 1, 0, -1, -1, 0, 1, -1, 0, -1, 1, 0, -1)

[sub_resource type="PanoramaSkyMaterial" id="PanoramaSkyMaterial_al2iq"]
panorama = ExtResource("5_1jq6i")

[sub_resource type="Sky" id="Sky_dmtm4"]
sky_material = SubResource("PanoramaSkyMaterial_al2iq")

[sub_resource type="Environment" id="Environment_1jq6i"]
background_mode = 2
background_color = Color(0.53, 0.81, 0.92, 1)
background_energy_multiplier = 0.31
sky = SubResource("Sky_dmtm4")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="BoxMesh" id="BoxMesh_al2iq"]

[sub_resource type="BoxShape3D" id="BoxShape3D_al2iq"]
size = Vector3(5, 1, 10)

[node name="Node3D" type="Node3D" node_paths=PackedStringArray("audioStreamPlayer")]
script = ExtResource("1_ki6c0")
marker_scene = ExtResource("2_hhxvm")
audioStreamPlayer = NodePath("AudioStreamPlayer3D")

[node name="CameraPlane" type="MeshInstance3D" parent="."]
transform = Transform3D(0.994259, 0, 0, 0, 0.994259, 0, 0, 0, 0.994259, -3.71361, 0, 0)
mesh = SubResource("PlaneMesh_twn0q")

[node name="maincharrigged" parent="." instance=ExtResource("2_8ifl6")]
transform = Transform3D(0.99749, -0.070801, 0, 0.070801, 0.99749, 0, 0, 0, 1, -0.620331, -0.031568, -0.406374)

[node name="RigidBody3D" type="RigidBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, -1.93774)
script = ExtResource("4_al2iq")
float_force = 1.3

[node name="MeshInstance3D" type="MeshInstance3D" parent="RigidBody3D"]
transform = Transform3D(0.07, 0, 0, 0, 0.07, 0, 0, 0, 0.07, 0, 0, 0)
mesh = ExtResource("3_twn0q")

[node name="CollisionShape3D" type="CollisionShape3D" parent="RigidBody3D"]
shape = SubResource("BoxShape3D_dmtm4")

[node name="maincharrigged2" parent="." instance=ExtResource("2_8ifl6")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.444229, 0, -0.379752)

[node name="Water" type="MeshInstance3D" parent="."]
transform = Transform3D(10, 0, 0, 0, 1, 0, 0, 0, 10, 0, 0, 0)
mesh = SubResource("BoxMesh_dmtm4")

[node name="Ground" type="MeshInstance3D" parent="."]
transform = Transform3D(10, 0, 0, 0, 1, 0, 0, 0, 10, 0, -1, 0)
mesh = SubResource("PlaneMesh_w16ng")

[node name="StaticBody3D" type="StaticBody3D" parent="Ground"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Ground/StaticBody3D"]
shape = SubResource("ConcavePolygonShape3D_twn0q")

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.434817, 2.66192)

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.374299, 0.927308, 0, -0.927308, 0.374299, 0, 5, 0)
light_energy = 0.67
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_1jq6i")

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="."]
stream = ExtResource("5_w16ng")

[node name="RigidBody3D2" type="RigidBody3D" parent="."]
script = ExtResource("8_dmtm4")

[node name="MeshInstance3D" type="MeshInstance3D" parent="RigidBody3D2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.90028477, 0.9720955, -1.9160886)
mesh = SubResource("BoxMesh_al2iq")

[node name="CollisionShape3D" type="CollisionShape3D" parent="RigidBody3D2"]
shape = SubResource("BoxShape3D_al2iq")
